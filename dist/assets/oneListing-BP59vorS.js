import{A as h,a as g}from"./constants-Cszep78z.js";async function w(t){try{const n=`${h}/${t}?_bids=true`;console.log("Fetching URL:",n);const e=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){const d=await e.json();return console.log("Response JSON:",d),d.data}else return console.error(`Failed to fetch listing: ${e.statusText}`),null}catch(n){return console.error("Error fetching listing:",n),null}}function L(t){const n=document.getElementById("display-one-listing");if(!n){console.error("Display container not found.");return}n.textContent="",console.log("Displaying Listing:",t);const e=document.createElement("div");e.classList.add("single-listing-wrapper","flex","mt-8","flex-col","md:flex-row","gap-8","items-start");const d=document.createElement("div"),o=document.createElement("img");o.classList.add("rounded-md","min-w-80","object-cover","h-80"),o.src=t.media&&t.media.length>0?t.media[0].url:"https://images.unsplash.com/photo-1557683316-973673baf926?w=900&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTB8fGNvbG9yfGVufDB8fDB8fHww",o.alt=t.media&&t.media.length>0?t.media[0].alt:"Default media",d.appendChild(o);const a=document.createElement("div");a.classList.add("md:w-1/2");const s=document.createElement("h1");s.textContent=t.title||"No title available";const i=document.createElement("h1"),c=t.bids&&t.bids.length>0?Math.max(...t.bids.map(b=>b.amount)):0;i.textContent=`Highest bid: ${c>0?`$${c}`:"No bids yet"}`;const m=document.createElement("h1"),u=t.bids?t.bids.length:0;m.textContent=`Total bids: ${u}`;const p=document.createElement("h1"),f=new Date(t.endsAt)-new Date,r=Math.ceil(f/(1e3*60*60*24));p.textContent=r>1?`${r} days left`:r===1?"1 day left":"Ended";const l=document.createElement("p");l.textContent=t.description||"No description available",l.classList.add("py-4","max-w-80"),a.append(s,i,m,p,l),e.append(d,a),n.appendChild(e)}async function x(){const t=window.location.search,e=new URLSearchParams(t).get("listingId");if(!e){console.error("No listing ID found in the URL.");return}console.log("Listing ID:",e);const d=await w(e);d?(L(d),E()):console.error("No data found for the specified listing ID.")}async function y(t){const n=document.getElementById("bid-amount").value,e=document.getElementById("bid-feedback");if(e.classList.add("hidden"),e.textContent="",!n||n<=0){e.textContent="Please enter a valid bid amount greater than 0.",e.classList.remove("hidden");return}const d=localStorage.getItem("accessToken"),o=JSON.stringify({amount:parseFloat(n)});try{const a=await fetch(`${h}/${t}/bids`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`,"X-Noroff-API-Key":g},body:o});if(a.ok)e.textContent="Bid placed successfully!",e.classList.remove("text-red-500"),e.classList.add("text-green-500"),e.classList.remove("hidden");else{const s=await a.json();e.textContent=`Error: ${s.message||"Failed to place bid."}`,e.classList.remove("hidden")}}catch{e.textContent="An error occurred while placing the bid.",e.classList.remove("hidden")}}function E(){const t=document.getElementById("bid-section");t.textContent="";const n=document.createElement("div");n.classList.add("p-6");const e=document.createElement("h1");if(e.textContent="Love it? Bid it",e.classList.add("font-bold","mb-4"),n.appendChild(e),localStorage.getItem("accessToken")){const o=document.createElement("div");o.classList.add("mt-2","flex","gap-2");const a=document.createElement("input");a.type="text",a.id="bid-amount",a.placeholder="Your bid",a.classList.add("bg-customDYellow","rounded-md","shadow-md","font-baloo","text-center","placeholder-black","p-3","mb-4","w-32");const s=document.createElement("button");s.id="place-bid",s.textContent="Bid!",s.classList.add("btn-secondary","mb-4","w-24"),s.addEventListener("click",()=>{const c=new URLSearchParams(window.location.search).get("listingId");y(c)}),o.appendChild(a),o.appendChild(s);const i=document.createElement("p");i.id="bid-feedback",i.classList.add("mt-2","font-baloo","text-red-500","hidden"),n.appendChild(o),n.appendChild(i)}else{const o=document.createElement("button");o.textContent="Log in to Bid",o.classList.add("btn-secondary","mb-4","w-full"),o.addEventListener("click",()=>{window.location.href="/src/html/login.html"}),n.appendChild(o)}t.appendChild(n)}x();
